---
description: 補完流域情報的「隱藏版」支流資料與河川代碼表 (CSV) 的流程
---

# Enrich River Hierarchy Data (補完河川代碼資料)

此任務旨在建立一個標準流程，透過 AI 協作與網路研究，將官方 GIS 圖資中遺漏的在地支流（如野溪、源頭、區域排水）補完至河川代碼 CSV 中，建立完整的流域戶口名簿。

## 0. 前置準備
- **目標流域**：確認要補完的主流域（如：濁水溪）。
- **基礎資料**：確保手邊已有 `河川代碼主從.csv` 或類似的基礎結構表 (e.g. `events/notes/data/河川整理資料 - 河川代碼主從.csv`)。
- **比對工具**：官方 SHP 圖資 (用於確認缺漏) 與網路搜尋工具。

## 1. 發現缺漏 (Identify Gaps)
- **視覺化比對**：將 SHP 圖資與 Google Maps / OSM 在地圖上疊合。
- **名單檢查**：檢查 CSV 名冊，找出：
    - **有圖無線**：地圖上有畫河道，但 CSV 沒名字。
    - **有名無圖**：CSV 有名字（通常是次要河川），但 SHP 沒畫線。
    - **完全隱形**：在地知名的戲水秘境、源頭或區域排水，CSV 與 SHP 都沒有。
- **關鍵字搜尋**：搜尋「XX溪 支流」、「XX溪 水系圖」、「XX縣管區域排水」，找出官方圖資未列出的溪流名稱。

## 2. 確認系譜 (Determine Topology)
針對每一個「隱藏版」溪流，必須確認其「輩分關係」（注入哪條河）。
- **工具 1: Wikipedia / 知識庫**：搜尋溪流名稱，通常會記載「發源於...注入...」。
- **工具 2: OpenStreetMap (Overpass Turbo)**：查詢 Relation 標籤，尋找 `destination` 或 `tributary_of` 屬性。
- **工具 3: 政府報告**：搜尋「XX縣管區域排水規劃報告」，裡面會有詳盡的水系圖。
- **工具 4: 地理推斷**：若無資料，查看該溪流流經的村落位置，推測其最可能注入的主流或支流。

## 3. 修訂 CSV 結構 (Update CSV)
將確認好的資料填入 `河川代碼主從.csv`，對於沒有官方代碼的溪流，採用以下「非官方編碼規則」：

| 欄位 | 填寫規則 | 範例 (霧社溪) |
| :--- | :--- | :--- |
| **river_id** | `流域ID_流水號` (避免與官方 6 碼數字衝突) | `1510_1` |
| **river_name** | 中文名稱 | `霧社溪` |
| **in_id** | **注入對象 ID** (Parent River ID) | `151000` (濁水溪) |
| **river_link** | **全路徑 ID 串列** (用於計算層級，以 `@` 分隔) | `0@151000@1510_1` |
| **note** | 備註資料來源或推測依據 | `Wiki: 濁水溪源頭` |

- **未知注入點處理**：若暫時查不到注入點，`in_id` 先留白或標記 `UNKNOWN`，待日後考證。

## 4. 驗證與應用 (Validation)
- **層級計算**：執行腳本重新計算 River Hierarchy (Order)，確認新加入的溪流被正確歸類（如：注入主流的為一級支流）。
- **視覺化測試**：若後續有視覺化程式，確認新溪流能被正確繪製或在列表清單中正確縮排顯示。

## 5. 輸出成果
- 更新後的 `河川代碼主從.csv`。
- (選用) 更新後的流域樹狀圖報告。
